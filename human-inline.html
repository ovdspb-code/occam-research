<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Human Connectome ‚Äî CRN Dynamics | CRN Interactive</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;500;600;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
<link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="style.css">
<script>
(function(){
  if(window.matchMedia('(prefers-color-scheme:dark)').matches) document.documentElement.setAttribute('data-theme','dark');
  window.toggleTheme = function(){
    const cur = document.documentElement.getAttribute('data-theme');
    const next = cur === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    const btn = document.getElementById('themeBtn');
    if(btn) btn.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    if(typeof renderAll === 'function') setTimeout(renderAll, 50);
  };
  window.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('themeBtn');
    if(btn) btn.textContent = (document.documentElement.getAttribute('data-theme')==='dark') ? '‚òÄÔ∏è' : 'üåô';
  });
})();
</script>
</head>
<body>
<header class="site-header">
<div class="wrap">
<nav class="nav">
  <a href="index.html" class="nav-brand">
    <img src="favicon.png" alt="Occam Research" class="nav-logo" style="height:28px;width:auto;">
    Occam Research
  </a>
  <div class="nav-right">
    <a href="index.html">‚Üê All organisms</a><a href="drosophila.html">Drosophila ‚Üí</a>
    <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()" title="Toggle dark/light mode" aria-label="Switch to dark mode">üåô</button>
  </div>
</nav>
</div>
</header>
<main>
<div class="wrap">

<section class="hero">
  <div class="hero-eyebrow"><span class="dot"></span>Human Connectome Project ¬∑ Subject 100206</div>
  <h1>CRN Dynamics on Basal Ganglia Pathways</h1>
  <p class="hero-sub">Interactive GKSL open-system transport on DTI-derived connectome subgraphs. Explore the inverted-U selectivity window predicted by CRN theory across two functionally distinct neural pathways.</p>
</section>

<div class="info-box">
  <h3>T2 / T3 Dissociation</h3>
  <p>Both ports show the inverted-U transport profile (ENAQT), but respond differently to weight perturbation. In <strong>T2</strong> (gating), shuffling edge weights destroys selectivity (G > 0) ‚Äî the <em>specific</em> DTI weight pattern matters. In <strong>T3</strong> (relay), surrogates perform equally well (G ‚âà 0) ‚Äî topology alone suffices. This double dissociation is a core prediction of CRN.</p>
</div>

<div class="tabs">
  <button class="tab-btn active" data-tab="t2">T2 ‚Äî Basal Ganglia</button>
  <button class="tab-btn" data-tab="t3">T3 ‚Äî Motor Relay</button>
</div>

<div class="tab-content active" id="panel-t2">
<div class="stat-grid">
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--accent)"></span>Subgraph Topology</div>
    <div class="stat-row"><span class="stat-label">ROI nodes</span><span class="stat-val">20</span></div>
    <div class="stat-row"><span class="stat-label">DTI edges</span><span class="stat-val">152</span></div>
    <div class="stat-row"><span class="stat-label">Density</span><span class="stat-val">0.80</span></div>
    <div class="stat-row"><span class="stat-label">Hemisphere</span><span class="stat-val">Left</span></div>
  </div>
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--teal)"></span>CRN Architecture</div>
    <div class="stat-row"><span class="stat-label">Sources (BG input)</span><span class="stat-val">3</span></div>
    <div class="stat-row"><span class="stat-label">Targets (gating out)</span><span class="stat-val">2</span></div>
    <div class="stat-row"><span class="stat-label">Intermediate ROIs</span><span class="stat-val">15</span></div>
    <div class="stat-row"><span class="stat-label">Disorder Œµ</span><span class="stat-val">2.0</span></div>
  </div>
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--warm)"></span>ENAQT Result</div>
    <div class="stat-row"><span class="stat-label">Peak R‚ÇÄ selectivity</span><span class="stat-val warn">7.13</span></div>
    <div class="stat-row"><span class="stat-label">Œ∫* (optimal)</span><span class="stat-val">1.0</span></div>
    <div class="stat-row"><span class="stat-label">Inverted-U window</span><span class="stat-val good">‚úì confirmed</span></div>
    <div class="stat-row"><span class="stat-label">Topology-specific</span><span class="stat-val good">‚úì G > 0</span></div>
  </div>
</div>

<div class="viz">
  <h2><span class="dot" style="background:var(--accent)"></span>Connectome ‚Äî Live GKSL Dynamics</h2>
  <div class="controls">
    <div class="control-group"><label>Œ∫ (dephasing)</label>
      <select id="kappaSelect">
        <option value="0">0.001 (coherent)</option><option value="1">0.01</option><option value="2">0.1</option>
        <option value="3">0.3</option><option value="4" selected>1.0 (optimal)</option>
        <option value="5">3.0</option><option value="6">10.0 (classical)</option>
      </select>
    </div>
    <div class="control-group"><label>Layout</label>
      <select id="layoutSelect"><option value="anatomical" selected>Anatomical</option><option value="hierarchical">Hierarchical</option><option value="force">Force-directed</option></select>
    </div>
    <div class="control-group"><label>Scale</label><input type="range" id="nodeSizeRange" min="0.5" max="3" value="1.5" step="0.1"></div>
    <button class="play-btn" id="playBtn">‚ñ∂ Play</button>
    <span class="time-display" id="timeDisplay">t = 0.00</span>
    <div class="control-group" style="flex:1;min-width:120px"><input type="range" id="timeSlider" min="0" max="50" value="0" step="1" style="width:100%"></div>
  </div>
  <canvas id="graphCanvas" width="1200" height="560"></canvas>
  <div class="legend">
    <div class="legend-item"><span class="legend-dot" style="background:var(--accent)"></span>Sources (Striatum)</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--warm)"></span>Targets (Thal / Pall)</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--teal)"></span>Intermediate (Cortical)</div>
    <div class="legend-item"><span class="legend-dot" style="background:rgba(0,0,0,.12)"></span>Node size ~ œÅ<sub>ii</sub>(t)</div>
  </div>
</div>

<div class="charts-row">
  <div class="chart-box"><h3>R‚ÇÄ(t) ‚Äî Selectivity Dynamics</h3><canvas id="r0Chart" width="560" height="260"></canvas></div>
  <div class="chart-box"><h3>Inverted-U ‚Äî R‚ÇÄ(T<sub>end</sub>) vs Œ∫</h3><canvas id="enaqtChart" width="560" height="260"></canvas></div>
</div>
<div class="charts-row">
  <div class="chart-box"><h3>P<sub>T</sub>(t) ‚Äî Target Absorption</h3><canvas id="ptChart" width="560" height="260"></canvas></div>
  <div class="chart-box"><h3>P<sub>D</sub>(t) ‚Äî Distractor Leakage</h3><canvas id="pdChart" width="560" height="260"></canvas></div>
</div>
</div>

<div class="tab-content" id="panel-t3">
<div class="stat-grid">
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--accent)"></span>Subgraph Topology</div>
    <div class="stat-row"><span class="stat-label">ROI nodes</span><span class="stat-val">~22</span></div>
    <div class="stat-row"><span class="stat-label">DTI edges</span><span class="stat-val">~170</span></div>
    <div class="stat-row"><span class="stat-label">Hemisphere</span><span class="stat-val">Left</span></div>
    <div class="stat-row"><span class="stat-label">Pathway</span><span class="stat-val">Thal ‚Üí Motor Ctx</span></div>
  </div>
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--teal)"></span>CRN Architecture</div>
    <div class="stat-row"><span class="stat-label">Sources</span><span class="stat-val">Thalamus</span></div>
    <div class="stat-row"><span class="stat-label">Targets</span><span class="stat-val">Precentral / Paracentral</span></div>
    <div class="stat-row"><span class="stat-label">Transport type</span><span class="stat-val warn">Structure-driven</span></div>
    <div class="stat-row"><span class="stat-label">Weight sensitivity</span><span class="stat-val">Low (G ‚âà 0)</span></div>
  </div>
  <div class="stat-card">
    <div class="stat-card-title"><span class="dot" style="background:var(--warm)"></span>Key Finding</div>
    <div class="stat-row"><span class="stat-label">ENAQT present</span><span class="stat-val good">‚úì</span></div>
    <div class="stat-row"><span class="stat-label">Topology-specific</span><span class="stat-val bad">‚úó G ‚âà 0</span></div>
    <div class="stat-row"><span class="stat-label">Interpretation</span><span class="stat-val">Relay, not gating</span></div>
    <div class="stat-row"><span class="stat-label">Weight shuffle</span><span class="stat-val">No effect</span></div>
  </div>
</div>
<div class="info-box" style="margin-top:var(--space-5)">
  <h3>T3 ‚Äî Motor Relay Pathway</h3>
  <p>T3 shows an inverted-U transport profile (ENAQT exists), but unlike T2, weight-shuffled surrogates perform equally well ‚Üí <strong>graph geometry alone drives transport</strong>. CRN theory predicts this: gating circuits (T2) require weight-tuned interference, relay circuits (T3) broadcast via structure.</p>
  <p style="margin-top:var(--space-3);color:var(--warm);font-size:var(--text-xs)">‚ö† T3 trajectory data not loaded. Run: <code style="background:var(--surface-alt);padding:2px 8px;border-radius:4px;font-family:var(--font-mono);font-size:var(--text-xs)">python crn_dump_trajectories.py --port T3 --outfile trajectories_100206_T3.json</code></p>
</div>
</div>

<div class="source-box">
  <strong>Data source:</strong> Human Connectome Project (HCP), Subject 100206, DTI tractography. Van Essen et al. (2013). <em>NeuroImage.</em> <a href="https://doi.org/10.1016/j.neuroimage.2013.05.041" target="_blank" rel="noopener noreferrer">doi:10.1016/j.neuroimage.2013.05.041</a><br>
  <strong>CRN framework:</strong> Dolgikh (2026). <a href="https://doi.org/10.5281/zenodo.18249250" target="_blank" rel="noopener noreferrer">doi:10.5281/zenodo.18249250</a><br>
  <strong>GKSL solver:</strong> RK2, dt=0.05, T<sub>end</sub>=10, Œ≥<sub>T</sub>=1.0, Œ≥<sub>L</sub>=5√ó10‚Åª‚Å¥, Œµ=2.0
</div>

</div>
</main>
<footer class="site-footer">
<div class="wrap">
  <div class="footer-bottom">
    <span>¬© 2026 Occam Research</span>
    <span><a href="https://occam.world" target="_blank" rel="noopener noreferrer">occam.world</a> ¬∑ CRN Interactive v4.0</span>
  </div>
</div>
</footer>

<script>

const TRAJ = {"kappa_values":[0.001,0.01,0.1,0.3,1.0,3.0,10.0],"time_points":[0.0,0.2,0.4,0.6,0.8,1.0,1.2,1.4,1.6,1.8,2.0,2.2,2.4,2.6,2.8,3.0,3.2,3.4,3.6,3.8,4.0,4.2,4.4,4.6,4.8,5.0,5.2,5.4,5.6,5.8,6.0,6.2,6.4,6.6,6.8,7.0,7.2,7.4,7.6,7.8,8.0,8.2,8.4,8.6,8.8,9.0,9.2,9.4,9.6,9.8,10.0],"rho_diag":[[[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],[0.33333,0.33333,0.33333,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0]],[[0.33192,0.33211,0.3333,0.00018,0.00011,0.00016,0.00011,0.00017,0.0002,0.00017,0.00015,0.00018,0.00019,0.00014,0.00015,0.00016,9e-05,0.00015,0.00011,0.00013],[0.33192,0.33211,0.3333,0.00018,0.00011,0.00016,0.00011,0.00017,0.0002,0.00017,0.00015,0.00018,0.00019,0.00014,0.00015,0.00016,9e-05,0.00015,0.00011,0.00013],[0.33193,0.33211,0.3333,0.00018,0.00011,0.00016,0.0001,0.00017,0.0002,0.00017,0.00015,0.00017,0.00019,0.00014,0.00015,0.00016,9e-05,0.00015,0.00011,0.00013],[0.33194,0.33213,0.3333,0.00018,0.00011,0.00016,0.0001,0.00017,0.0002,0.00017,0.00014,0.00017,0.00019,0.00013,0.00015,0.00016,8e-05,0.00015,0.00011,0.00013],[0.332,0.33218,0.3333,0.00017,0.00011,0.00015,0.0001,0.00016,0.00019,0.00016,0.00014,0.00017,0.00018,0.00013,0.00014,0.00015,8e-05,0.00014,0.00011,0.00013],[0.33215,0.3323,0.3333,0.00015,9e-05,0.00013,9e-05,0.00014,0.00017,0.00014,0.00012,0.00015,0.00016,0.00011,0.00012,0.00014,7e-05,0.00013,0.0001,0.00011],[0.3325,0.33261,0.3333,0.00011,6e-05,9e-05,6e-05,0.0001,0.00012,0.0001,8e-05,0.0001,0.00011,8e-05,9e-05,... [truncated, 66140 chars]
const NODES=[
{idx:0,short:"L-Caudate",role:"source",x:52.8,y:68.4,z:22.1},
{idx:1,short:"L-Putamen",role:"source",x:58.7,y:65.8,z:16.4},
{idx:2,short:"L-Accumbens",role:"source",x:56,y:70,z:13},
{idx:3,short:"L-Thalamus",role:"target",x:51.1,y:57.1,z:18.9},
{idx:4,short:"L-Pallidum",role:"target",x:55.7,y:64.3,z:14.8},
{idx:5,short:"PostCingulate",role:"inter",x:47.3,y:57.3,z:29.7},
{idx:6,short:"IsthmusCing",role:"inter",x:48.4,y:44,z:22.2},
{idx:7,short:"CaudAntCing",role:"inter",x:48.2,y:73.9,z:29.1},
{idx:8,short:"CaudMidFront",role:"inter",x:67.4,y:67.4,z:36.2},
{idx:9,short:"Insula",role:"inter",x:62.6,y:55.2,z:21.9},
{idx:10,short:"PostCing2",role:"inter",x:48.9,y:48.2,z:32.4},
{idx:11,short:"Precentral",role:"inter",x:69.4,y:56.7,z:32.9},
{idx:12,short:"RostMidFront",role:"inter",x:61.6,y:78.7,z:33.7},
{idx:13,short:"SupParietal3",role:"inter",x:58.9,y:35.6,z:33.4},
{idx:14,short:"Supramarg",role:"inter",x:68.2,y:38.4,z:36.3},
{idx:15,short:"SupParietal2",role:"inter",x:63.2,y:38.5,z:42.5},
{idx:16,short:"Precuneus5",role:"inter",x:53,y:34.8,z:23},
{idx:17,short:"SupFrontal",role:"inter",x:48.4,y:59.2,z:43.4},
{idx:18,short:"Precuneus2",role:"inter",x:50.4,y:40.6,z:36.2},
{idx:19,short:"CaudMidFr2",role:"inter",x:59.8,y:72.1,z:39.9}
];
const EDGES=[];
(function(){const N=NODES.length;for(let i=0;i<N;i++)for(let j=i+1;j<N;j++){const m=TRAJ.rho_diag[25][4],w=Math.sqrt(m[i]*m[j]);if(w>0.0001||Math.random()<0.75)EDGES.push({s:i,t:j,w:Math.max(w,0.001)})}})();

function cs(v){return getComputedStyle(document.documentElement).getPropertyValue(v).trim()}
function isDark(){return document.documentElement.getAttribute('data-theme')==='dark'}

const W=1200,H=560,PAD=60;
let nodePositions=new Array(NODES.length);
function layoutAnatomical(){const xs=NODES.map(n=>n.x),ys=NODES.map(n=>n.y),zs=NODES.map(n=>n.z);const x0=Math.min(...xs),x1=Math.max(...xs),y0=Math.min(...ys),y1=Math.max(...ys),z0=Math.min(...zs),z1=Math.max(...zs);NODES.forEach((n,i)=>{const nx=(n.x-x0)/(x1-x0+1e-6),ny=(n.y-y0)/(y1-y0+1e-6),nz=(n.z-z0)/(z1-z0+1e-6);nodePositions[i]={x:PAD+(nx*.4+ny*.6)*(W-2*PAD),y:PAD+(1-nz)*(H-2*PAD)}})}
function layoutHierarchical(){const L={source:[],target:[],inter:[]};NODES.forEach((n,i)=>L[n.role].push(i));L.source.forEach((x,i)=>{nodePositions[x]={x:PAD+(i+.5)/L.source.length*(W-2*PAD),y:H*.13}});L.inter.forEach((x,i)=>{nodePositions[x]={x:PAD+80+(i%5)*(W-2*PAD-160)/4,y:H*.5-30+Math.floor(i/5)*45}});L.target.forEach((x,i)=>{nodePositions[x]={x:PAD+(i+.5)/L.target.length*(W-2*PAD),y:H*.87}})}
function layoutForce(){NODES.forEach((n,i)=>{nodePositions[i]={x:W*.2+Math.random()*W*.6,y:H*.2+Math.random()*H*.6,vx:0,vy:0}});for(let it=0;it<120;it++){for(let i=0;i<NODES.length;i++)for(let j=i+1;j<NODES.length;j++){const dx=nodePositions[j].x-nodePositions[i].x,dy=nodePositions[j].y-nodePositions[i].y,d=Math.sqrt(dx*dx+dy*dy)+1,f=800/(d*d);nodePositions[i].vx-=f*dx/d;nodePositions[i].vy-=f*dy/d;nodePositions[j].vx+=f*dx/d;nodePositions[j].vy+=f*dy/d}EDGES.forEach(e=>{const dx=nodePositions[e.t].x-nodePositions[e.s].x,dy=nodePositions[e.t].y-nodePositions[e.s].y,d=Math.sqrt(dx*dx+dy*dy)+1,f=(d-80)*.003;nodePositions[e.s].vx+=f*dx/d;nodePositions[e.s].vy+=f*dy/d;nodePositions[e.t].vx-=f*dx/d;nodePositions[e.t].vy-=f*dy/d});NODES.forEach((n,i)=>{nodePositions[i].x+=nodePositions[i].vx*.1;nodePositions[i].y+=nodePositions[i].vy*.1;nodePositions[i].vx*=.8;nodePositions[i].vy*=.8;nodePositions[i].x=Math.max(PAD,Math.min(W-PAD,nodePositions[i].x));nodePositions[i].y=Math.max(PAD,Math.min(H-PAD,nodePositions[i].y))})}}
const layouts={anatomical:layoutAnatomical,hierarchical:layoutHierarchical,force:layoutForce};
layoutAnatomical();

let curK=4,curT=0,playing=false,nScale=1.5,hovered=-1;
const canvas=document.getElementById('graphCanvas'),ctx=canvas.getContext('2d');

function renderGraph(){
  const dpr=window.devicePixelRatio||1;canvas.width=W*dpr;canvas.height=H*dpr;canvas.style.width=W+'px';canvas.style.height=H+'px';ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.fillStyle=cs('--canvas-bg');ctx.fillRect(0,0,W,H);
  const rho=TRAJ.rho_diag[curT][curK],mx=Math.max(...rho,.01);
  const colMap={source:cs('--accent'),target:cs('--warm'),inter:cs('--teal')};
  const glowA={source:.15,target:.15,inter:.1};
  // edges
  EDGES.forEach(e=>{const a=nodePositions[e.s],b=nodePositions[e.t],I=(rho[e.s]+rho[e.t])/(2*mx);ctx.globalAlpha=.03+I*.12;ctx.strokeStyle=cs('--text-3');ctx.lineWidth=.3+I*1.2;ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke()});
  ctx.globalAlpha=1;
  // nodes
  NODES.forEach((n,i)=>{const p=nodePositions[i],pop=rho[i],np=pop/mx,bR=n.role==='inter'?5:7,r=(bR+np*16)*nScale,col=colMap[n.role];
    if(np>.05){const g=ctx.createRadialGradient(p.x,p.y,r*.5,p.x,p.y,r*2.5);g.addColorStop(0,col.replace(')',','+glowA[n.role]+')').replace('rgb','rgba'));g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(p.x,p.y,r*2.5,0,Math.PI*2);ctx.fill()}
    ctx.fillStyle=col;ctx.globalAlpha=.25+np*.75;ctx.beginPath();ctx.arc(p.x,p.y,r,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;
    if(i===hovered){ctx.strokeStyle=col;ctx.lineWidth=2;ctx.beginPath();ctx.arc(p.x,p.y,r+3,0,Math.PI*2);ctx.stroke()}
    if(r>6*nScale||i===hovered){ctx.fillStyle=cs('--text');ctx.font=`${Math.max(9,Math.min(12,r*.7))}px Inter`;ctx.textAlign='center';ctx.fillText(n.short,p.x,p.y-r-5)}
    if(i===hovered){ctx.fillStyle=cs('--text-2');ctx.font="11px 'JetBrains Mono'";ctx.textAlign='center';ctx.fillText('\u03C1='+pop.toFixed(5),p.x,p.y+r+14)}
  });
  ctx.fillStyle=cs('--text-3');ctx.font="11px 'JetBrains Mono'";ctx.textAlign='left';
  ctx.fillText('t='+TRAJ.time_points[curT].toFixed(2)+' | \u03BA='+TRAJ.kappa_values[curK]+' | R\u2080='+TRAJ.R0[curT][curK].toFixed(3),12,H-10);
}

function drawChart(cid,getData,opts={}){
  const c=document.getElementById(cid);if(!c)return;const cx=c.getContext('2d');
  const dpr=window.devicePixelRatio||1,cw=560,ch=260;c.width=cw*dpr;c.height=ch*dpr;c.style.width=cw+'px';c.style.height=ch+'px';cx.setTransform(dpr,0,0,dpr,0,0);
  cx.fillStyle=cs('--surface');cx.fillRect(0,0,cw,ch);
  const pad={l:50,r:20,t:15,b:28},pw=cw-pad.l-pad.r,ph=ch-pad.t-pad.b;
  const data=getData();let xn=Infinity,xx=-Infinity,yn=Infinity,yx=-Infinity;
  data.forEach(s=>s.points.forEach(p=>{if(opts.logX){if(p.x>0){xn=Math.min(xn,Math.log10(p.x));xx=Math.max(xx,Math.log10(p.x))}}else{xn=Math.min(xn,p.x);xx=Math.max(xx,p.x)}yn=Math.min(yn,p.y);yx=Math.max(yx,p.y)}));
  yn=opts.ymin!==undefined?opts.ymin:yn*.9;yx=yx*1.1||1;
  const tX=v=>pad.l+((opts.logX?Math.log10(v):v)-xn)/(xx-xn)*pw,tY=v=>pad.t+(1-(v-yn)/(yx-yn))*ph;
  cx.strokeStyle=cs('--border');cx.lineWidth=.5;
  for(let i=0;i<=4;i++){const y=pad.t+i*ph/4;cx.beginPath();cx.moveTo(pad.l,y);cx.lineTo(pad.l+pw,y);cx.stroke();cx.fillStyle=cs('--text-3');cx.font="10px 'JetBrains Mono'";cx.textAlign='right';cx.fillText((yx-(yx-yn)*i/4).toFixed(opts.yD||2),pad.l-6,y+3)}
  cx.fillStyle=cs('--text-3');cx.font="10px 'JetBrains Mono'";cx.textAlign='center';
  if(opts.logX)TRAJ.kappa_values.forEach(k=>{cx.fillText(k+'',tX(k),ch-6)});
  else for(let t=0;t<=10;t+=2)cx.fillText(t+'',tX(t),ch-6);
  const kC=[cs('--c0'),cs('--c1'),cs('--c2'),cs('--c3'),cs('--c4'),cs('--c5'),cs('--c6')];
  data.forEach((s,si)=>{cx.strokeStyle=s.color||(kC[si]||cs('--accent'));cx.lineWidth=s.hl?2.5:1.2;cx.globalAlpha=s.hl?1:.5;cx.beginPath();s.points.forEach((p,i)=>{const x=tX(p.x),y=tY(p.y);if(i===0)cx.moveTo(x,y);else cx.lineTo(x,y)});cx.stroke();cx.globalAlpha=1});
  if(opts.tCursor){const t=TRAJ.time_points[curT],x=tX(t);cx.strokeStyle=cs('--accent')+'66';cx.lineWidth=1;cx.setLineDash([3,3]);cx.beginPath();cx.moveTo(x,pad.t);cx.lineTo(x,pad.t+ph);cx.stroke();cx.setLineDash([])}
  if(opts.kCursor){const k=TRAJ.kappa_values[curK],x=tX(k);cx.strokeStyle=cs('--accent')+'88';cx.lineWidth=1.5;cx.setLineDash([4,4]);cx.beginPath();cx.moveTo(x,pad.t);cx.lineTo(x,pad.t+ph);cx.stroke();cx.setLineDash([]);
    const pk=TRAJ.kappa_values[4],px=tX(pk),py=tY(7.1305);cx.fillStyle=cs('--warm');cx.beginPath();cx.arc(px,py,5,0,Math.PI*2);cx.fill();cx.font="10px Inter";cx.textAlign='left';cx.fillText('\u03BA*=1.0, R\u2080=7.13',px+8,py-3)}
}

function renderAll(){
  renderGraph();
  const kC=[cs('--c0'),cs('--c1'),cs('--c2'),cs('--c3'),cs('--c4'),cs('--c5'),cs('--c6')];
  drawChart('r0Chart',()=>TRAJ.kappa_values.map((k,ki)=>({color:kC[ki],hl:ki===curK,points:TRAJ.time_points.map((t,ti)=>({x:t,y:TRAJ.R0[ti][ki]}))})),{tCursor:1,ymin:0,yD:1});
  drawChart('enaqtChart',()=>{const li=TRAJ.time_points.length-1;return[{color:cs('--warm'),hl:1,points:TRAJ.kappa_values.map((k,ki)=>({x:k,y:TRAJ.R0[li][ki]}))}]},{logX:1,kCursor:1,ymin:0,yD:1});
  drawChart('ptChart',()=>TRAJ.kappa_values.map((k,ki)=>({color:kC[ki],hl:ki===curK,points:TRAJ.time_points.map((t,ti)=>({x:t,y:TRAJ.P_T[ti][ki]}))})),{tCursor:1,ymin:0,yD:3});
  drawChart('pdChart',()=>TRAJ.kappa_values.map((k,ki)=>({color:kC[ki],hl:ki===curK,points:TRAJ.time_points.map((t,ti)=>({x:t,y:TRAJ.P_D[ti][ki]}))})),{tCursor:1,ymin:0,yD:4});
  document.getElementById('timeDisplay').textContent='t = '+TRAJ.time_points[curT].toFixed(2);
  document.getElementById('timeSlider').value=curT;
}
document.getElementById('kappaSelect').onchange=e=>{curK=+e.target.value;renderAll()};
document.getElementById('layoutSelect').onchange=e=>{layouts[e.target.value]();renderAll()};
document.getElementById('nodeSizeRange').oninput=e=>{nScale=+e.target.value;renderAll()};
document.getElementById('timeSlider').oninput=e=>{curT=+e.target.value;renderAll()};
document.getElementById('playBtn').onclick=()=>{playing=!playing;document.getElementById('playBtn').textContent=playing?'\u23F8 Pause':'\u25B6 Play';if(playing)anim()};
let lt=0;function anim(){if(!playing)return;const n=performance.now();if(n-lt>80){curT++;if(curT>=TRAJ.time_points.length)curT=0;renderAll();lt=n}requestAnimationFrame(anim)}
canvas.onmousemove=e=>{const r=canvas.getBoundingClientRect(),mx=(e.clientX-r.left)/(r.width/W),my=(e.clientY-r.top)/(r.height/H);hovered=-1;NODES.forEach((n,i)=>{const p=nodePositions[i],dx=mx-p.x,dy=my-p.y;if(dx*dx+dy*dy<400)hovered=i});renderGraph()};
canvas.onmouseleave=()=>{hovered=-1;renderGraph()};
document.querySelectorAll('.tab-btn').forEach(b=>{b.onclick=()=>{document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));b.classList.add('active');document.getElementById('panel-'+b.dataset.tab).classList.add('active')}});
renderAll();

</script>
</body>
</html>
